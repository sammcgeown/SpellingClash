{{define "list_detail.tmpl"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="/static/js/htmx.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="dashboard">
            <header class="dashboard-header">
                <h1>WordClash</h1>
                <div class="user-info">
                    <span>Welcome, {{.User.Name}}!</span>
                    <form method="POST" action="/logout" style="display: inline;">
                        <button type="submit" class="btn btn-secondary">Logout</button>
                    </form>
                </div>
            </header>

            <nav class="dashboard-nav">
                <a href="/parent/dashboard" class="nav-link">Dashboard</a>
                <a href="/parent/family" class="nav-link">Manage Families</a>
                <a href="/parent/kids" class="nav-link">Manage Kids</a>
                <a href="/parent/lists" class="nav-link active">Manage Lists</a>
            </nav>

    <main class="dashboard-main">
        <div class="page-header">
            <div>
                <a href="/parent/lists" class="back-link">← Back to Lists</a>
                <h2>{{.List.Name}}</h2>
                {{if .List.Description}}
                <p class="list-description">{{.List.Description}}</p>
                {{end}}
            </div>
            <form method="POST" action="/parent/lists/{{.List.ID}}/delete" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this list and all its words?');">
                <button type="submit" class="btn btn-danger">Delete List</button>
            </form>
        </div>

        <div class="list-detail-grid">
            <!-- Words Section -->
            <div class="section-card">
                <div class="section-header">
                    <h3>Words ({{len .Words}})</h3>
                    <button class="btn btn-primary btn-sm" onclick="document.getElementById('add-word-form').style.display='block'">
                        + Add Word
                    </button>
                </div>

                <div id="add-word-form" class="inline-form" style="display:none;">
                    <form method="POST" action="/parent/lists/{{.List.ID}}/words/add">
                        <div class="form-row">
                            <input type="text" name="word" placeholder="Enter word" required autofocus>
                            <select name="difficulty">
                                <option value="1">Easy</option>
                                <option value="2">Medium-Easy</option>
                                <option value="3" selected>Medium</option>
                                <option value="4">Medium-Hard</option>
                                <option value="5">Hard</option>
                            </select>
                            <button type="submit" class="btn btn-primary btn-sm">Add</button>
                            <button type="button" class="btn btn-secondary btn-sm" onclick="document.getElementById('add-word-form').style.display='none'">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>

                {{if .Words}}
                <div class="words-list">
                    {{range .Words}}
                    <div class="word-item">
                        <div class="word-info">
                            <span class="word-text">{{.WordText}}</span>
                            <span class="difficulty-badge difficulty-{{.DifficultyLevel}}">
                                {{if eq .DifficultyLevel 1}}Easy{{else if eq .DifficultyLevel 2}}Med-Easy{{else if eq .DifficultyLevel 3}}Medium{{else if eq .DifficultyLevel 4}}Med-Hard{{else}}Hard{{end}}
                            </span>
                        </div>
                        <form method="POST" action="/parent/lists/{{.SpellingListID}}/words/{{.ID}}/delete" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Delete this word?');">×</button>
                        </form>
                    </div>
                    {{end}}
                </div>
                {{else}}
                <div class="empty-state-small">
                    <p>No words added yet. Add your first word to get started!</p>
                </div>
                {{end}}
            </div>

            <!-- Assignments Section -->
            <div class="section-card">
                <h3>Assigned To</h3>

                {{if .FamilyKids}}
                <div class="assign-kids">
                    {{range .FamilyKids}}
                    {{$isAssigned := false}}
                    {{range $.AssignedKids}}
                        {{if eq .ID $.ID}}
                            {{$isAssigned = true}}
                        {{end}}
                    {{end}}

                    <div class="assign-kid-item">
                        <div class="kid-info-small">
                            <div class="kid-avatar-small" style="background-color: {{.AvatarColor}}">
                                {{slice .Name 0 1}}
                            </div>
                            <span>{{.Name}}</span>
                        </div>

                        {{$kidAssigned := false}}
                        {{range $.AssignedKids}}
                            {{if eq .ID $.ID}}
                                {{$kidAssigned = true}}
                            {{end}}
                        {{end}}

                        {{if $kidAssigned}}
                        <form method="POST" action="/parent/lists/{{$.List.ID}}/unassign/{{.ID}}">
                            <button type="submit" class="btn btn-secondary btn-sm">Unassign</button>
                        </form>
                        {{else}}
                        <form method="POST" action="/parent/lists/{{$.List.ID}}/assign/{{.ID}}">
                            <button type="submit" class="btn btn-primary btn-sm">Assign</button>
                        </form>
                        {{end}}
                    </div>
                    {{end}}
                </div>
                {{else}}
                <div class="empty-state-small">
                    <p>No kids in this family yet.</p>
                    <a href="/parent/kids" class="btn btn-primary btn-sm">Add Kids</a>
                </div>
                {{end}}
            </div>
            </div>
        </main>
        </div>
    </div>
</body>
</html>
{{end}}
